{% extends "base.html" %}
{% load shop_extras %}

{% block head %}
<script language="javascript" type="text/javascript" src="/media/js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="/media/js/jquery.flot.pack.js"></script>
{% endblock %}

{% block body_script %}
onload="onLoad();" onresize="onResize();"
{% endblock %}

{% block breadcrumbs %}

    Магазин

{% endblock %}

{% block content %}

<h1 style="font-weight:normal">Цены магазина: <b>{{ shop.title }}</b>, {{ shop.addr.city }}, {{ shop.addr.street }}, {{ shop.addr.house }}</h1>

<table>
{% for trade in trade_list %}
<tr>
<td><i>{{ trade.time|date:"j b" }}&nbsp</i></td>
<td style="text-align:right">
{% if is_profile and trade.spytrade %}<img src="/media/eye.png"> {% endif %}
<b>{% if trade.user = user %}<a href="/trade/{{ trade.id }}">{{ trade.price }}</a>
{% else %}{{ trade.price }}</b>
{% endif %}</td>
<td>{{ trade.get_currency_display }}/{{ trade.goods.get_ed_display }}</td>
<td><a href="/goods/{{ trade.goods.id }}">{{ trade.goods.title }}</a></td>
</tr>
{% endfor %}
</table>

{% if goods_id %}
<script type="text/javascript">
$(function () {
//    var d1 = [[1,25],[2,26]];
    
//    for (var i = 0; i < {{ trade_list.count }}; i += 1)
//        d1.push([i, {{ trade_list }});
    var i = 1;
    var d1 = [
    {% for trade in trade_list %}
    [{{ trade.time|epoch }},{{ trade.price }}],
    {% endfor %}
    ];
    $.plot($("#placeholder"), [d1,], {
        lines: { show: true },
        points: { show: true },
        yaxis: {
            tickDecimals: 2},
        xaxis: {
            minTickSize: [1, "day"],
            mode: "time",
            timeformat: "%y/%m/%d"},
    });
});
</script>

<div id="placeholder" style="width:100%;height:300px;"></div>
{% endif %}

{% endblock %}

{% block left %}
    <table width=100%>
    {% for goods in goods_top %}
    <tr>
    <td>{{ goods.goods_count }}x</td>
    <td><a href="/shop/{{ shop.id }}/goods/{{ goods.goods__id }}">{{ goods.goods__title }}</a></td>
    </tr>
    {% endfor %}
    </table>
{% endblock %}